# 📱 WiFi 配网功能演示指南

> 如何测试 BLE WiFi 配网功能

---

## 🎯 测试前准备

### 1. 设备端准备

确保你的 ESP32/PLAUD 设备固件已实现以下功能：

- ✅ BLE 服务 UUID: `0000FFE0-0000-1000-8000-00805F9B34FB`
- ✅ BLE 特征 UUID: `0000FFE1-0000-1000-8000-00805F9B34FB`
- ✅ 支持 `scan_wifi` 命令
- ✅ 支持 `wifi_config` 命令
- ✅ 通过 Notify 返回 JSON 格式数据

### 2. App 端准备

编译并安装 App：

**iOS 真机（Profile 模式）**:
```bash
cd /Users/xionghao/Documents/plaud/GitHub/flutter-ble
flutter run --profile -d 00008140-000C384614FA801C
```

**Android 设备**:
```bash
cd /Users/xionghao/Documents/plaud/GitHub/flutter-ble
flutter run --profile -d <android-device-id>
```

**或使用 VS Code**: 按 `F5` 并选择 `Flutter (Profile - iOS)` 或 `Flutter (Profile - Android)`

---

## 🧪 测试流程

### 测试场景 1: 基础配网流程 ✅

**步骤**:
1. 打开 App，等待扫描 PLAUD 设备
2. 点击设备连接
3. 连接成功后，点击 "WiFi 配置" 卡片
4. 等待 WiFi 扫描完成（约 5-10 秒）
5. 选择一个信号强的 WiFi
6. 输入正确的密码（8-63 字符）
7. 点击 "连接"
8. 等待配置结果

**预期结果**:
- ✅ 显示 "配置成功" 对话框
- ✅ 显示设备 IP 地址和信号强度
- ✅ 提示设备即将重启
- ✅ 点击 "完成" 返回设备详情页

---

### 测试场景 2: 信号强度显示 📶

**测试点**:
- WiFi 列表按信号强度排序（从强到弱）
- 信号强度用颜色标识：
  - 🟢 绿色 = 优秀（-30 ~ 0 dBm）
  - 🟢 浅绿 = 良好（-50 ~ -30 dBm）
  - 🟡 橙色 = 一般（-70 ~ -50 dBm）
  - 🟠 深橙 = 较差（-90 ~ -70 dBm）
  - 🔴 红色 = 很差（< -90 dBm）

**验证方法**:
1. 查看 WiFi 列表中每个网络的信号强度标签
2. 确认颜色和描述匹配

---

### 测试场景 3: 开放网络配网 🔓

**步骤**:
1. 在 WiFi 列表中选择一个开放网络（无锁图标）
2. 确认直接开始配网，不弹出密码输入框
3. 等待配置结果

**预期结果**:
- ✅ 无需输入密码
- ✅ 直接开始配网
- ✅ 配置成功或失败

---

### 测试场景 4: 密码错误处理 ❌

**步骤**:
1. 选择一个需要密码的 WiFi
2. 输入错误的密码
3. 点击 "连接"

**预期结果**:
- ✅ 显示 "配置失败" 对话框
- ✅ 错误信息：密码错误（错误码 1001）
- ✅ 提供 "重新扫描" 按钮

---

### 测试场景 5: 密码长度验证 ⚠️

**测试点**:
1. 输入少于 8 个字符的密码
2. 输入多于 63 个字符的密码

**预期结果**:
- ✅ 显示 SnackBar: "密码长度需为 8-63 个字符"
- ✅ 不会发送配网命令

---

### 测试场景 6: 配网超时 ⏱️

**模拟方法**:
- 设备端不响应 `wifi_config` 命令

**预期结果**:
- ✅ 40 秒后显示 "配置超时" 提示
- ✅ 提供重试选项

---

### 测试场景 7: 刷新 WiFi 列表 🔄

**步骤**:
1. 查看当前 WiFi 列表
2. 点击右上角刷新按钮
3. 等待重新扫描

**预期结果**:
- ✅ 显示 "正在扫描 WiFi 网络..." 加载状态
- ✅ 扫描完成后更新列表
- ✅ 列表按信号强度重新排序

---

### 测试场景 8: 连接中断处理 🔌

**模拟方法**:
- 在配网过程中关闭设备蓝牙或断开连接

**预期结果**:
- ✅ 显示连接断开提示
- ✅ 自动返回设备列表

---

## 📊 测试检查清单

### UI/UX 测试

- [ ] WiFi 列表卡片显示正常
- [ ] 信号强度图标和颜色正确
- [ ] 加密类型显示正确（开放/WPA2/WPA3 等）
- [ ] SSID 名称正确显示（包括中文）
- [ ] 锁图标显示正确
- [ ] 信号值（dBm）显示正确
- [ ] 密码输入框可以显示/隐藏
- [ ] 加载状态显示正常
- [ ] 错误提示清晰易懂
- [ ] 成功对话框信息完整

### 功能测试

- [ ] 自动初始化并扫描 WiFi
- [ ] 手动刷新扫描正常
- [ ] 下拉刷新正常
- [ ] 密码长度验证正确
- [ ] 开放网络无需密码
- [ ] 配网成功后显示完整信息
- [ ] 配网失败后显示错误原因
- [ ] 错误码映射正确
- [ ] 超时机制正常工作
- [ ] 返回按钮正常工作

### 边界测试

- [ ] 空 WiFi 列表显示正确
- [ ] WiFi 扫描超时处理
- [ ] 配网超时处理
- [ ] 最长 SSID 名称（32 字节）
- [ ] 最长密码（63 字符）
- [ ] 最短密码（8 字符）
- [ ] 特殊字符密码
- [ ] 中文 SSID

### 性能测试

- [ ] WiFi 扫描响应时间 < 15 秒
- [ ] 配网时间 < 40 秒
- [ ] UI 流畅，无卡顿
- [ ] 内存占用正常

---

## 🐛 调试技巧

### 1. 查看 BLE 通信日志

在 VS Code 的 Debug Console 中查看日志：

```
[BLE WiFi] 开始初始化...
[BLE WiFi] 发现服务: 0000FFE0-...
[BLE WiFi] 发现特征: 0000FFE1-...
[BLE WiFi] 已启用通知
[BLE WiFi] 初始化成功
[BLE WiFi] 发送数据: {"cmd":"scan_wifi"}
[BLE WiFi] 收到数据: {"cmd":"scan_wifi","status":"success",...}
```

### 2. 使用 BLE 调试工具

**iOS**: LightBlue Explorer
**Android**: nRF Connect

**验证内容**:
- Service UUID 是否正确
- Characteristic UUID 是否正确
- Notify 是否启用
- 写入和通知数据格式

### 3. 模拟设备响应

如果没有实际设备，可以使用以下工具模拟：
- nRF Connect (模拟 Peripheral)
- Web Bluetooth Test (Chrome)

---

## 📝 测试报告模板

```
测试日期: 2024-11-13
测试人员: [姓名]
测试设备: 
- 手机: iPhone 15 / Android 12
- PLAUD 设备: [型号] [固件版本]

测试结果:
✅ 基础配网流程: 通过
✅ 信号强度显示: 通过
✅ 开放网络配网: 通过
✅ 密码错误处理: 通过
✅ 密码长度验证: 通过
❌ 配网超时: 失败（原因：...）

发现的问题:
1. [描述问题]
2. [描述问题]

建议:
1. [改进建议]
2. [改进建议]
```

---

## 🎉 测试通过标准

所有以下项目都通过才算测试成功：

1. ✅ 能正常扫描并显示 WiFi 列表
2. ✅ 信号强度和加密类型显示正确
3. ✅ 能成功配置 WiFi（至少一次）
4. ✅ 密码错误时有明确提示
5. ✅ 配置成功后有详细信息和引导
6. ✅ UI 流畅，无明显卡顿
7. ✅ 错误处理完善，无崩溃

---

## 📞 遇到问题？

1. 检查设备固件是否正确实现协议
2. 查看 Debug Console 日志
3. 使用 BLE 调试工具验证
4. 参考 `ble-wifi-provisioning-spec.md` 文档
5. 联系开发团队

---

**祝测试顺利！** 🚀


