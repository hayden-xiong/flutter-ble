# 🔄 重新安装应用以修复权限问题

## 问题原因
在 iPhone 设置中找不到"位置"选项，是因为：
- 应用第一次安装时的权限配置不完整
- iOS 需要重新安装才能识别新的权限配置

## ✅ 解决方案：卸载并重新安装

### 步骤 1：在 iPhone 上卸载应用
1. 在 iPhone 主屏幕上找到 **"Flutter Ble"** 应用图标
2. **长按**图标，直到出现菜单
3. 点击 **"移除 App"**
4. 选择 **"删除 App"**
5. 确认删除

### 步骤 2：重新安装应用
在 Mac 终端运行：
```bash
cd /Users/xionghao/Documents/plaud/GitHub/flutter-ble
flutter run --profile -d 00008140-000C384614FA801C
```

### 步骤 3：首次启动会弹出权限请求
重新安装后，应用第一次启动时会自动弹出：

1. **蓝牙权限请求**
   ```
   "Flutter Ble"想要使用蓝牙
   ├─ 拒绝
   └─ 好  ✓ 点这个
   ```

2. **位置权限请求**（这个是关键！）
   ```
   允许"Flutter Ble"在您使用该应用时访问您的位置？
   ├─ 不允许
   ├─ 允许一次
   ├─ 使用 App 期间允许  ✓ 点这个
   └─ 始终允许
   ```

**请选择"使用 App 期间允许"！**

### 步骤 4：验证权限
安装完成后，进入 iPhone 设置验证：
1. 打开**设置**
2. 向下滚动找到 **"Flutter Ble"**
3. 应该能看到：
   ```
   位置          使用 App 期间 >
   蓝牙          ✓
   ```

## 🚀 快速执行
直接复制粘贴到终端执行：
```bash
cd /Users/xionghao/Documents/plaud/GitHub/flutter-ble
flutter run --profile -d 00008140-000C384614FA801C
```

## ⚠️ 注意事项

### 如果弹窗没出现
如果重新安装后，位置权限弹窗还是没有出现：

1. 完全重启 iPhone
   - 长按电源键 + 音量键
   - 滑动关机
   - 等待 10 秒
   - 重新开机

2. 重置位置与隐私设置
   - 设置 → 通用 → 传输或还原 iPhone
   - 还原 → 还原位置与隐私
   - 输入密码确认
   - 重新安装应用

3. 手动触发权限请求
   应用启动后，点击"重试"按钮，会再次尝试请求权限

### 为什么需要位置权限？
这是 iOS 的系统要求：
- iOS 13+ 扫描蓝牙设备（BLE）必须要位置权限
- 即使应用不使用 GPS，也需要这个权限
- 这是 Apple 的隐私保护机制
- 所有 iOS 蓝牙应用都有这个要求

## 🎯 预期效果

### 正确安装后的效果
1. 应用启动
2. 弹出蓝牙权限 → 点击"好"
3. 弹出位置权限 → 选择"使用 App 期间允许"
4. 显示加载动画："正在扫描蓝牙设备..."
5. 显示设备列表或"未发现设备"提示

### 检查权限是否正确
```
iPhone 设置 → Flutter Ble
├─ 位置: 使用 App 期间  ✓
└─ 蓝牙: ✓
```

如果看到这样的配置，说明权限正确！

